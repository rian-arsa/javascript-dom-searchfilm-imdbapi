<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  </head>
  <body>
    <div style="width: 800px;" class="container mt-5">
        <!-- SEARCH -->
        <label for="search" class="h3">Cari film</label>
        <br> 
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Masukkan judul film" aria-label="Masukkan judul film" aria-describedby="button-addon2" id="search">
            <button class="btn btn-primary" type="button" id="button-addon2">Search</button>
          </div>
        <!-- CONTENT -->
        <div class="row row-cols-1 row-cols-md-3 g-4" id="listFilm">
            
          </div>
    </div>
    
    <!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Detail Film</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="card">
                <img class="card-img-top" alt="..." id="cardImg">
                <div class="card-body">
                  <h5 class="card-title" id="cardTitle"></h5>
                  <p class="card-text" id="plot"></p>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item" id="years">An item</li>
                  <li class="list-group-item" id="genre">A second item</li>
                  <li class="list-group-item" id="imdbRating">A third item</li>
                </ul>
              </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <script>

        const buttonSearch = document.getElementById("button-addon2")
        
        buttonSearch.onclick = function() {
            const searchValue = document.getElementById("search").value
            
            const request = new Request(`http://www.omdbapi.com/?apikey=3321c94b&s=${searchValue}`);
            const response = fetch(request)

            response
                .then((result) =>  result.json())
                .then((result) => {
                    const movies = result.Search
                    let cards = ''
                    movies.forEach(element => {
                        cards  += card(element)
                    });
                    const list = document.getElementById("listFilm")
                    list.innerHTML = cards

                    const modalDetailButton = document.querySelectorAll(".modal-detail-button")
                    modalDetailButton.forEach(btn => {
                        btn.addEventListener("click", function() {
                            const request = new Request(`http://www.omdbapi.com/?apikey=3321c94b&i=${this.dataset.imdbid}`);
                            const response = fetch(request) 

                            response
                                .then((result) => result.json())
                                .then((json) => {
                                    // Title
                                    const cardTitle = document.getElementById("cardTitle")
                                    cardTitle.innerText = json.Title
                                    // IMG
                                    const cardImg = document.getElementById("cardImg")
                                    const imgSrc = cardImg.setAttribute("src", json.Poster)
                                    cardImg.setAttributeNode(imgSrc)
                                    // Plot
                                    const plot = document.getElementById("plot")
                                    plot.innerText = json.Plot
                                    console.log(json.Plot);
                                    console.log("ok");

                                })
                                .catch(()=> "ERROR")

                        })
                    });

                }).catch((error) => {
                    const p = document.createElement("h1")
                    p.innerText = "Film Tidak Ditemukan, Silahkan cari dengan keyword yang lain"
                    const list = document.getElementById("listFilm")
                    list.appendChild(p);
                })
        }

        function card(m) {
            return `
                <div class="col">
                    <div class="card h-100">
                        <img src="${m.Poster}" class="card-img-top" alt="...">
                        <div class="card-body">
                        <h5 class="card-title">${m.Title}</h5>
                        <p class="card-text">${m.Year}</p>
                        <button type="button" class="btn btn-primary modal-detail-button" data-bs-toggle="modal" data-imdbid="${m.imdbID}" data-bs-target="#exampleModal">
                        Detail
                        </button>
                        </div>
                    </div>
                    </div>
        `
        }
        
    </script>
</body>
</html>